<script>
    // ... (نفس الكود السابق حتى نهاية دالة touchend) ...

    // مصفوفة حجارة الكمبيوتر
    let computerHand = [];
    let boneyardTiles = 14;

    // دالة لتوزيع يد الكمبيوتر في بداية اللعبة
    function setupComputer() {
        for(let i=0; i<7; i++) {
            // حجارة الكمبيوتر مخفية (القيمة v1, v2 محفوظة لكن لا نرسم نقاطها للاعب)
            const v1 = Math.floor(Math.random()*7);
            const v2 = Math.floor(Math.random()*7);
            computerHand.push({v1, v2});
        }
    }
    setupComputer();

    async function computerTurn() {
        document.getElementById('turn-info').innerText = "دور الكمبيوتر...";
        document.getElementById('turn-info').style.color = "#ff4444";
        
        // انتظار ثانية لمحاكاة التفكير
        await new Promise(r => setTimeout(r, 1500));

        let foundIndex = -1;
        let side = ""; // هل سيلعب يميناً أم يساراً؟

        // البحث عن حجر مناسب
        for(let i=0; i < computerHand.length; i++) {
            const cv1 = computerHand[i].v1;
            const cv2 = computerHand[i].v2;
            
            if(cv1 === rightValue || cv2 === rightValue) { foundIndex = i; side = "right"; break; }
            if(cv1 === leftValue || cv2 === leftValue) { foundIndex = i; side = "left"; break; }
        }

        if(foundIndex !== -1) {
            const tileData = computerHand[foundIndex];
            // إنشاء الحجر برمجياً على الطاولة
            let xPos, rot = 0;
            if(side === "right") {
                xPos = rightAnchorX + 0.8;
                // منطق التدوير للكمبيوتر
                rot = (tileData.v1 === rightValue) ? Math.PI/2 : -Math.PI/2;
                rightValue = (tileData.v1 === rightValue) ? tileData.v2 : tileData.v1;
                rightAnchorX += 1.6;
            } else {
                xPos = leftAnchorX - 0.8;
                rot = (tileData.v2 === leftValue) ? Math.PI/2 : -Math.PI/2;
                leftValue = (tileData.v2 === leftValue) ? tileData.v1 : tileData.v2;
                leftAnchorX -= 1.6;
            }

            const cTile = createTile(xPos, 0, tileData.v1, tileData.v2, false);
            cTile.rotation.y = rot;
            
            computerHand.splice(foundIndex, 1);
            document.getElementById('msg').innerText = "الكمبيوتر لعب حجرًا!";
        } else {
            document.getElementById('msg').innerText = "الكمبيوتر لم يجد حجرًا وسحب من البنك";
            // هنا ممكن نضيف وظيفة سحب من البنك للكمبيوتر
        }

        document.getElementById('turn-info').innerText = "دورك الآن";
        document.getElementById('turn-info').style.color = "#ffcc00";
    }

    // تعديل بسيط: عند انتهاء حركة اللاعب بنجاح، استدعِ دور الكمبيوتر
    // داخل touchend، بعد "played = true":
    // if(played) { ... setTimeout(computerTurn, 500); }
</script>
