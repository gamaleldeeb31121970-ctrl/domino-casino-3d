<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Domino Pro - Snapping</title>
    <style>
        body { margin: 0; overflow: hidden; background-color: #031006; font-family: sans-serif; }
        #ui-layer {
            position: absolute; top: 10px; width: 100%;
            display: flex; justify-content: space-between; padding: 0 15px;
            box-sizing: border-box; z-index: 100; pointer-events: none;
        }
        .pill { background: rgba(0,0,0,0.8); color: #ffcc00; padding: 6px 15px; border-radius: 20px; border: 1px solid #ffd700; font-size: 13px; font-weight: bold; }
        #boneyard {
            position: absolute; right: 10px; top: 50%; transform: translateY(-50%);
            background: #e67e22; color: #fff; width: 40px; height: 70px;
            border-radius: 8px; display: flex; align-items: center; justify-content: center;
            font-weight: bold; border: 2px solid #d35400; font-size: 20px;
        }
        #msg { position: absolute; bottom: 130px; width: 100%; text-align: center; color: #fff; font-size: 14px; text-shadow: 1px 1px 2px #000; pointer-events: none; }
    </style>
</head>
<body>
    <div id="ui-layer">
        <div class="pill">ğŸ’° 28.5M</div>
        <div class="pill">ğŸ’¸ 1K</div>
    </div>
    <div id="boneyard">13</div>
    <div id="msg">Ù‚Ø±Ø¨ Ø§Ù„Ø­Ø¬Ø± Ù…Ù† Ø§Ù„Ù…Ù†ØªØµÙ Ù„ÙŠÙ„ØªØµÙ‚</div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>

    <script>
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.position.set(0, 17, 10); // Ø²Ø§ÙˆÙŠØ© Ø±Ø¤ÙŠØ© Ø£ÙˆØ¶Ø­
        camera.lookAt(0, 0, 1);

        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(window.devicePixelRatio);
        document.body.appendChild(renderer.domElement);

        scene.add(new THREE.AmbientLight(0xffffff, 0.6));
        const sun = new THREE.DirectionalLight(0xffffff, 0.8);
        sun.position.set(5, 15, 5);
        scene.add(sun);

        const table = new THREE.Mesh(new THREE.PlaneGeometry(40, 30), new THREE.MeshStandardMaterial({ color: 0x125424, roughness: 1 }));
        table.rotation.x = -Math.PI / 2;
        scene.add(table);

        // Ø£Ø¨Ø¹Ø§Ø¯ Ø§Ù„Ø­Ø¬Ø± Ø§Ù„Ø·Ø¨ÙŠØ¹ÙŠØ©
        const T_WIDTH = 0.8; const T_HEIGHT = 0.18; const T_LENGTH = 1.6;
        
        let playerHand = [];
        let boardTiles = []; // Ù„ØªØªØ¨Ø¹ Ø§Ù„Ø­Ø¬Ø§Ø±Ø© Ø§Ù„Ù„ÙŠ Ø§ØªÙ„Ø¹Ø¨Øª
        let selectedTile = null;
        const raycaster = new THREE.Raycaster(); const mouse = new THREE.Vector2();

        // Ù…ØªØºÙŠØ±Ø§Øª Ù„ØªØªØ¨Ø¹ Ø£Ø·Ø±Ø§Ù Ø§Ù„Ø³Ù„Ø³Ù„Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø·Ø§ÙˆÙ„Ø©
        let boardAnchorLeft = -T_LENGTH / 2;
        let boardAnchorRight = T_LENGTH / 2;

        function createTile(x, z, v1, v2, isHand = false) {
            const group = new THREE.Group();
            const body = new THREE.Mesh(new THREE.BoxGeometry(T_WIDTH, T_HEIGHT, T_LENGTH), new THREE.MeshStandardMaterial({ color: 0xfafafa, roughness: 0.2 }));
            group.add(body);
            const line = new THREE.Mesh(new THREE.PlaneGeometry(T_WIDTH - 0.1, 0.03), new THREE.MeshBasicMaterial({ color: 0x333333 }));
            line.rotation.x = -Math.PI / 2; line.position.y = T_HEIGHT/2 + 0.01; group.add(line);

            // Ø±Ø³Ù… Ù†Ù‚Ø§Ø· Ø¨Ø³ÙŠØ·Ø© Ù„Ù„ØªÙˆØ¶ÙŠØ­
            const dotGeo = new THREE.CircleGeometry(0.08, 8); const dotMat = new THREE.MeshBasicMaterial({ color: 0x000000 });
            if(v1>0){ const d1=new THREE.Mesh(dotGeo,dotMat); d1.rotation.x=-Math.PI/2; d1.position.set(0,T_HEIGHT/2+0.011, 0.4); group.add(d1); }
            if(v2>0){ const d2=new THREE.Mesh(dotGeo,dotMat); d2.rotation.x=-Math.PI/2; d2.position.set(0,T_HEIGHT/2+0.011, -0.4); group.add(d2); }

            group.position.set(x, T_HEIGHT/2, z);
            group.userData = { v1, v2, isHand, originalX: x, originalZ: z };
            scene.add(group);
            if(isHand) playerHand.push(group); else boardTiles.push(group);
            return group;
        }

        // 1. ÙˆØ¶Ø¹ Ø­Ø¬Ø± Ø¨Ø¯Ø§ÙŠØ© ÙÙŠ Ø§Ù„Ù…Ù†ØªØµÙ (Ø§Ù„Ø¬ÙˆÙƒØ± Ù…Ø«Ù„Ø§Ù‹)
        createTile(0, 0, 6, 6, false);

        // 2. ØªÙˆØ²ÙŠØ¹ ÙŠØ¯ Ø§Ù„Ù„Ø§Ø¹Ø¨
        for(let i=0; i<7; i++) {
            createTile(-3 + (i * 1.0), 6.5, i, Math.floor(Math.random()*7), true);
        }

        // --- Ø§Ù„ØªÙØ§Ø¹Ù„ ÙˆØ§Ù„Ø§Ù„ØªØµØ§Ù‚ ---
        window.addEventListener('touchstart', (e) => {
            mouse.x = (e.touches[0].clientX / window.innerWidth) * 2 - 1;
            mouse.y = -(e.touches[0].clientY / window.innerHeight) * 2 + 1;
            raycaster.setFromCamera(mouse, camera);
            const intersects = raycaster.intersectObjects(playerHand, true);
            if (intersects.length > 0) {
                selectedTile = intersects[0].object.parent;
                selectedTile.position.y = 1.5; // Ø±ÙØ¹ Ø§Ù„Ø­Ø¬Ø± Ø¹Ø§Ù„ÙŠØ§Ù‹ Ø¹Ù†Ø¯ Ø§Ù„Ø³Ø­Ø¨
            }
        }, false);

        window.addEventListener('touchmove', (e) => {
            if (!selectedTile) return;
            mouse.x = (e.touches[0].clientX / window.innerWidth) * 2 - 1;
            mouse.y = -(e.touches[0].clientY / window.innerHeight) * 2 + 1;
            raycaster.setFromCamera(mouse, camera);
            const intersectTable = raycaster.intersectObject(table);
            if (intersectTable.length > 0) {
                selectedTile.position.x = intersectTable[0].point.x;
                selectedTile.position.z = intersectTable[0].point.z;
            }
        }, false);

        window.addEventListener('touchend', () => {
            if (selectedTile) {
                // Ù…Ù†Ø·Ù‚ Ø§Ù„Ù…ØºÙ†Ø§Ø·ÙŠØ³ (Snapping Logic)
                const snapDistance = 2.0; // Ø§Ù„Ù…Ø³Ø§ÙØ© Ø§Ù„ØªÙŠ ÙŠØ¨Ø¯Ø£ Ø¹Ù†Ø¯Ù‡Ø§ Ø§Ù„Ø¬Ø°Ø¨
                let snapped = false;

                // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù‚Ø±Ø¨ Ù„Ù„Ø·Ø±Ù Ø§Ù„Ø£ÙŠÙ…Ù†
                if (Math.abs(selectedTile.position.x - boardAnchorRight) < snapDistance && Math.abs(selectedTile.position.z) < snapDistance) {
                    selectedTile.position.set(boardAnchorRight + T_LENGTH/2 + 0.05, T_HEIGHT/2, 0); // 0.05 Ù…Ø³Ø§ÙØ© ØµØºÙŠØ±Ø© Ø¨ÙŠÙ† Ø§Ù„Ø­Ø¬Ø±ÙŠÙ†
                    boardAnchorRight += T_LENGTH + 0.05; // ØªØ­Ø¯ÙŠØ« Ù…ÙƒØ§Ù† Ø§Ù„Ø·Ø±Ù Ø§Ù„Ø£ÙŠÙ…Ù† Ø§Ù„Ø¬Ø¯ÙŠØ¯
                    snapped = true;
                } 
                // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù‚Ø±Ø¨ Ù„Ù„Ø·Ø±Ù Ø§Ù„Ø£ÙŠØ³Ø±
                else if (Math.abs(selectedTile.position.x - boardAnchorLeft) < snapDistance && Math.abs(selectedTile.position.z) < snapDistance) {
                    selectedTile.position.set(boardAnchorLeft - T_LENGTH/2 - 0.05, T_HEIGHT/2, 0);
                    boardAnchorLeft -= (T_LENGTH + 0.05); // ØªØ­Ø¯ÙŠØ« Ù…ÙƒØ§Ù† Ø§Ù„Ø·Ø±Ù Ø§Ù„Ø£ÙŠØ³Ø± Ø§Ù„Ø¬Ø¯ÙŠØ¯
                    snapped = true;
                }

                if (snapped) {
                    // ØªØ«Ø¨ÙŠØª Ø§Ù„Ø­Ø¬Ø± ÙˆØ¥Ø²Ø§Ù„ØªÙ‡ Ù…Ù† Ø§Ù„ÙŠØ¯
                    selectedTile.userData.isHand = false;
                    boardTiles.push(selectedTile);
                    playerHand = playerHand.filter(t => t !== selectedTile);
                    document.getElementById('msg').innerText = "ØªÙ… Ù„Ø¹Ø¨ Ø§Ù„Ø­Ø¬Ø±!";
                } else {
                    // Ø¥Ø±Ø¬Ø§Ø¹ Ø§Ù„Ø­Ø¬Ø± Ù„Ù„ÙŠØ¯ Ø¥Ø°Ø§ Ù„Ù… ÙŠÙ„ØªØµÙ‚
                    selectedTile.position.set(selectedTile.userData.originalX, T_HEIGHT/2, selectedTile.userData.originalZ);
                }
                selectedTile = null;
            }
        }, false);

        function animate() { requestAnimationFrame(animate); renderer.render(scene, camera); }
        animate();
        window.addEventListener('resize', () => { camera.aspect = window.innerWidth/window.innerHeight; camera.updateProjectionMatrix(); renderer.setSize(window.innerWidth, window.innerHeight); });
    </script>
</body>
</html>
